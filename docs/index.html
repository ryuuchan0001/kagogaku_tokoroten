<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ãƒã‚¤ã‚¯ã§å‹•ã2Dã‚¢ã‚¯ã‚·ãƒ§ãƒ³</title>
<style>
  canvas { background: #222; display: block; margin: 0 auto; }
</style>
</head>
<body>
<canvas id="game" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let player = { x: 100, y: 300, vy: 0, onGround: true };
let micLevel = 0;

// ğŸ¤ ãƒã‚¤ã‚¯å…¥åŠ›ã®å–å¾—
async function setupMic() {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const audioCtx = new AudioContext();
  const analyser = audioCtx.createAnalyser();
  const source = audioCtx.createMediaStreamSource(stream);
  source.connect(analyser);

  const data = new Uint8Array(analyser.fftSize);
  function getMicLevel() {
    analyser.getByteTimeDomainData(data);
    const rms = Math.sqrt(data.reduce((s, v) => s + (v - 128) ** 2, 0) / data.length);
    micLevel = rms;
    requestAnimationFrame(getMicLevel);
  }
  getMicLevel();
}

setupMic();

// ğŸ•¹ï¸ ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "white";
  ctx.fillRect(0, 380, 800, 20); // åœ°é¢
  ctx.fillStyle = "cyan";
  ctx.fillRect(player.x, player.y - 20, 20, 20);

  // ğŸ¤ éŸ³é‡ãŒä¸€å®šä»¥ä¸Šãªã‚‰ã‚¸ãƒ£ãƒ³ãƒ—
  if (micLevel > 10 && player.onGround) {
    player.vy = -10;
    player.onGround = false;
  }

  // é‡åŠ›å‡¦ç†
  player.vy += 0.5;
  player.y += player.vy;
  if (player.y >= 300) {
    player.y = 300;
    player.vy = 0;
    player.onGround = true;
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
